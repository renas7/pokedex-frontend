<!-- pokemon-form.component.html -->
<h2>Add Pokémon</h2>

<form [formGroup]="form" (ngSubmit)="submit()">
  <fieldset>
    <legend>Basic Info</legend>
    <label>Name <input formControlName="name"></label>
    <label>Number <input type="number" formControlName="number"></label>
    <label>Species <input formControlName="species"></label>
    <label>Height (m) <input type="number" step="0.01" formControlName="height"></label>
    <label>Weight (kg) <input type="number" step="0.1" formControlName="weight"></label>
    <label>Generation <input type="number" formControlName="generation"></label>
    <label>Base Exp <input type="number" formControlName="base_experience"></label>
    <label>Capture Rate <input type="number" formControlName="capture_rate"></label>
    <label>Hatch Time <input type="number" formControlName="hatch_time"></label>
    <label>Base Friendship <input type="number" formControlName="base_friendship"></label>
    <label>Male % <input type="number" step="0.1" formControlName="gender_male"></label>
    <label>Female % <input type="number" step="0.1" formControlName="gender_female"></label>
  </fieldset>

  <fieldset>
    <legend>Types</legend>
    <label>Type 1 (primary)
      <select formControlName="type1_id">
        <option [ngValue]="null">— select —</option>
        <option *ngFor="let t of types" [value]="t.id">{{ t.name }}</option>
      </select>
    </label>

    <label>Type 2 (optional)
      <select formControlName="type2_id">
        <option [ngValue]="null">— none —</option>
        <option *ngFor="let t of types"
                [value]="t.id"
                [disabled]="type1Id != null && t.id === type1Id">
          {{ t.name }}
        </option>
      </select>
    </label>

    <small *ngIf="form.value.type1_id && form.value.type2_id && form.value.type1_id === form.value.type2_id"
          style="color:#f87171">Type 1 and Type 2 cannot be the same.</small>
    <small>A single-type Pokémon should leave Type 2 as “none”.</small>
  </fieldset>

  <fieldset>
    <legend>Abilities</legend>

    <label>Normal Abilities</label>
    <select multiple formControlName="normal_ability_ids">
      <option *ngFor="let a of abilitiesList" [value]="a.id">{{ a.name }}</option>
    </select>

    <label>Hidden Ability</label>
    <select formControlName="hidden_ability_id">
      <option [ngValue]="null">— none —</option>
      <option *ngFor="let a of abilitiesList" [value]="a.id">{{ a.name }}</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>Egg Groups</legend>
    <select multiple formControlName="egg_group_ids">
      <option
        *ngFor="let g of eggGroups"
        [value]="g.id"
        [disabled]="(form.value.egg_group_ids?.length || 0) >= 2
                    && !(form.value.egg_group_ids?.includes(g.id))">
        {{ g.name }}
      </option>
    </select>
    <small>Pick up to 2.</small>
  </fieldset>

  <fieldset formGroupName="stats">
    <legend>Base Stats</legend>
    <label>HP <input type="number" formControlName="hp"></label>
    <label>Attack <input type="number" formControlName="attack"></label>
    <label>Defense <input type="number" formControlName="defense"></label>
    <label>Sp. Atk <input type="number" formControlName="sp_atk"></label>
    <label>Sp. Def <input type="number" formControlName="sp_def"></label>
    <label>Speed <input type="number" formControlName="speed"></label>
  </fieldset>

  <fieldset>
    <legend>Descriptions</legend>
    <div formArrayName="descriptions">
      <div *ngFor="let d of descriptionsFA.controls; let i = index" [formGroupName]="i">
        <input placeholder="Game" formControlName="game">
        <textarea placeholder="Entry" formControlName="text"></textarea>
        <button type="button" (click)="removeDescription(i)">Remove</button>
      </div>
    </div>
    <button type="button" (click)="addDescription()">+ Add Description</button>
  </fieldset>

  <fieldset>
    <legend>Evolutions (from this Pokémon → …)</legend>
    <div formArrayName="evolutions">
      <div *ngFor="let e of evolutionsFA.controls; let i = index" [formGroupName]="i">

        <div class="row" style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
          <label>To Pokémon (ID)
            <select formControlName="to_pokemon_id">
              <option [ngValue]="null">— select —</option>
              <option *ngFor="let p of pokemonList" [value]="p.id">
                {{ p.name }} <span *ngIf="p.number">(#{{ p.number }})</span>
              </option>
            </select>
          </label>

          <label>or To Number
            <input type="number" formControlName="to_number" placeholder="e.g. 2">
          </label>
        </div>

        <input formControlName="method" placeholder="Method (Level Up, etc)">
        <input type="number" formControlName="level" placeholder="Level (optional)">
        <button type="button" (click)="removeEvolution(i)">Remove</button>
      </div>
    </div>
    <button type="button" (click)="addEvolution()">+ Add Evolution</button>
    <small>Either select the target by ID or fill the Pokédex number. Backend will resolve the number.</small>
  </fieldset>

  <fieldset>
    <legend>Forms (optional)</legend>
    <div formArrayName="forms">
      <div *ngFor="let f of formsFA.controls; let i = index" [formGroupName]="i">
        <input formControlName="form_name" placeholder="Form name (Alolan, Mega...)">
        <input formControlName="form_type" placeholder="Type/Region (optional)">
        <button type="button" (click)="removeFormRow(i)">Remove</button>
      </div>
    </div>
    <button type="button" (click)="addFormRow()">+ Add Form</button>
  </fieldset>

  <button type="submit">Save Pokémon</button>
</form>
